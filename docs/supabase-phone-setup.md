# Supabase 手机验证码配置指南

## 📱 手机号登录配置

Supabase 支持手机号 + 验证码的登录方式，需要配置短信发送服务。

## 1. 🔧 Supabase Auth 手机号配置

### 步骤A：启用手机号认证
1. 打开 Supabase 项目控制台：https://supabase.com/dashboard/project/jleiazztrzjunxuzbkgd
2. 点击 **Authentication** → **Settings**
3. 在 **Auth Providers** 部分找到 **Phone**
4. ✅ 勾选 **"Enable phone confirmations"**
5. 点击 **Save**

---

## 2. 📨 短信服务提供商配置

### 选项A：使用 Twilio（推荐）

#### 获取 Twilio 凭据：
1. 注册 [Twilio](https://www.twilio.com/) 账号
2. 获取以下信息：
   - **Account SID**
   - **Auth Token**
   - **Phone Number**（Twilio提供的发送号码）

#### 在 Supabase 中配置：
1. 在 **Authentication** → **Settings** 页面
2. 滚动到 **SMS Provider Settings**
3. 选择 **Twilio**
4. 填入配置：
   ```
   Twilio Account SID: ACxxxxxx
   Twilio Auth Token: xxxxxx
   Twilio Phone Number: +1234567890
   ```

### 选项B：使用阿里云SMS（国内推荐）

#### 获取阿里云SMS凭据：
1. 登录 [阿里云控制台](https://www.aliyun.com/)
2. 开通短信服务
3. 获取：
   - **AccessKey ID**
   - **AccessKey Secret**
   - **签名名称**
   - **模板CODE**

#### 配置自定义短信提供商：
由于 Supabase 原生不支持阿里云，需要使用 **Database Function** 或 **Edge Function** 来实现。

---

## 3. 💰 费用预估

### Twilio 价格：
- **验证码短信**：约 $0.075/条（美国）
- **国际短信**：$0.10-0.20/条（中国）
- **月租费**：$1.15/月（电话号码）

### 阿里云SMS价格：
- **验证码短信**：约 ¥0.045/条
- **无月租费**
- **更适合国内用户**

---

## 4. 🚀 测试手机号登录

### 测试步骤：
1. **部署最新代码**到 Vercel
2. **访问登录页面**：https://reface.vercel.app/auth/login
3. **点击"手机号登录"**
4. **输入手机号**：+86 13800138000（中国大陆号码需要 +86 前缀）
5. **点击"发送验证码"**
6. **检查手机收到的验证码**
7. **输入验证码并登录**

### 调试信息：
打开浏览器开发者工具，查看：
- **Network 标签**：检查API请求是否成功
- **Console 标签**：查看错误信息

---

## 5. 🐛 常见问题

### 问题1：验证码发送失败
**可能原因**：
- Twilio/阿里云配置错误
- 短信服务余额不足
- 手机号格式不正确

**解决方案**：
- 检查 Supabase 短信配置
- 确认短信服务账户余额
- 手机号必须包含国家代码（如 +86）

### 问题2：验证码收不到
**可能原因**：
- 短信被运营商拦截
- 号码在黑名单中
- 发送频率过高

**解决方案**：
- 尝试其他手机号
- 检查垃圾短信文件夹
- 等待几分钟后重试

### 问题3：验证码验证失败
**可能原因**：
- 验证码过期（通常5-10分钟）
- 验证码输入错误
- 网络连接问题

**解决方案**：
- 重新发送验证码
- 检查验证码是否正确
- 刷新页面重试

---

## 6. 📋 当前状态检查

目前需要你完成的配置：

### ✅ 已完成：
- 前端手机号登录UI
- 后端API调用逻辑
- 数据库用户表支持手机号

### ⏳ 待配置：
- Supabase 中启用手机号认证
- 选择并配置短信服务提供商（Twilio 或阿里云SMS）

---

## 7. 🎯 推荐配置顺序

### 第一步：启用基础功能
1. 在 Supabase 启用手机号认证
2. 暂时使用 Twilio 免费试用（每月可发送数百条）

### 第二步：选择正式方案
根据用户群体选择：
- **海外用户为主**：继续使用 Twilio
- **国内用户为主**：迁移到阿里云SMS

### 第三步：监控和优化
- 监控短信发送成功率
- 优化验证码模板
- 设置发送频率限制

---

## 8. 💡 提醒

- 📱 手机号登录功能代码已完成，等你配置短信服务即可使用
- 🔧 Google登录配置完成后优先测试，手机号登录可以后续完善
- 💰 建议先使用 Twilio 免费额度测试功能是否正常

有任何配置问题随时告诉我！
